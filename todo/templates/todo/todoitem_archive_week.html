{% extends 'todo/base.html' %}

{% block content %}

<div class="row">
  <div class="d-flex justify-content-center">
    <h4>To-do items due during the week of {{week|date:"D"}}, {{ week }}</h4>
  </div>
  <div class="col" style="margin-bottom:5px;">
    <div class="d-flex justify-content-center">
      <a href="/{{previous_week.year}}/week/{{previous_week|date:"W"}}/" class="btn btn-outline-secondary" style="margin-top:5px;">Previous week</a>
      <a href="/{{next_week.year}}/week/{{next_week|date:"W"}}/" class="btn btn-outline-secondary" style="margin-top:5px;">Next week</a>
    </div>
  </div>
</div>

<div class="row">
  <div class="row">
    <div class="dropdown">
      <button
        class="btn btn-sm btn-outline-secondary dropdown-toggle"
        href="#"
        id="viewDropdown"
        role="button"
        data-toggle="dropdown"
        aria-haspopup="true"
        aria-expanded="false"
      >
        View by Dates
      </button>
      <div class="dropdown-menu" aria-labelledby="viewDropdown">
        <a class="dropdown-item" href="{% url 'todo_list:archive_today' %}">
          Today
        </a>
        <a class="dropdown-item" href="{% url 'todo_list:day' %}">
          Day view
        </a>
        <a class="dropdown-item" href="{% url 'todo_list:week' %}">
          Week view
        </a>
        <a class="dropdown-item" href="{% url 'todo_list:month' %}">
          Month view
        </a>
      </div>
    </div>
  </div>

  <div class="col">
    <div class="d-flex justify-content-center">
      {% if object_list %}
      <ul class="w-50 list-group">
        <div id="accordion">
          <!-- accordion is the template for collapsing bars -->
          {% for todo_item in object_list %}
            <div class="card">
              <button
                class="btn collapsed"
                id="cardButton"
                data-toggle="collapse"
                data-target="#collapse{{forloop.counter}}"
              >
              <li class="list-group-item">
                {% if todo_item.priority == "HI" and not todo_item.completed %}
                <div class="card-header border border-danger" id="header{{forloop.counter}}">
                {% elif todo_item.priority == "MD" and not todo_item.completed %}
                <div class="card-header border border-warning" id="header{{forloop.counter}}">
                {% else %}
                <div class="card-header border bg-light" id="header{{forloop.counter}}">
                {% endif %}
                
                <p class="d-flex justify-content-start">
                  {% if not todo_item.completed %}
                    {{todo_item.title}}
                  {% else %}
                    <del>{{todo_item.title}}</del>
                  {% endif %}
                </p>

                <div class="d-flex justify-content-around mt-3">
                  {% if todo_item.completed %}
                  <small><i>Task Completed!</i></small>
                  {% endif %}
                  <small>due {{todo_item.duedate}}</small>
                </div>
                </div>
              </button>
                <!--forloop.counter gives each instance of todo_item a different id so each box collapses independently of each other -->
                <div id="collapse{{forloop.counter}}" class="collapse">
                  <!--body of the accordion card -->
                  <div class="card-body">
                    <ul style="list-style-type:none">
                      {% if todo_item.description %}
                      <li>
                        <strong>Description:</strong> {{ todo_item.description }}
                      </li>
                      {% endif %} {% if todo_item.location %}
                      <li><strong>Location:</strong> {{ todo_item.location }}</li>
                      {% endif %}
                      {% if todo_item.recur_freq %}
                      <li><strong>Repeat:</strong> {{ todo_item.recur_freq }}</li>
                      {% endif %}
                      {% if todo_item.end_recur_date %}
                      <li>
                        <strong>End repeat:</strong> {{ todo_item.end_recur_date }}</li>
                      {% endif %}

                      {% if todo_item.category != 'NN' %}
                      <li><strong>Category:</strong> {{ todo_item.get_category_display }}</li>
                      {% if todo_item.category == 'AC' %}
                        {% if todo_item.course %}
                          <li><strong>Course:</strong> {{ todo_item.course }}</li>
                        {% endif %}
                      {% elif todo_item.category == 'EC' %}
                        {% if todo_item.ec %}
                          <li><strong>Activity:</strong> {{ todo_item.ec }}</li>
                        {% endif %}
                      {% endif %}
                    {% endif %}
                    </ul>
                    {% if todo_item.subtask_set.all %}
                      <ul>
                        {% for subtask in todo_item.subtask_set.all %}
                          {% if not subtask.completed %}
                            <li>
                              <a href="{% url 'todo_list:complete_subtask' subtask.id %}">
                                {{ subtask }}</a>
                            </li>
                          {% else %}
                            <li>
                              <a href="{% url 'todo_list:complete_subtask' subtask.id %}">
                                <del>{{ subtask }}</del></a>
                            </li>
                          {% endif %}
                        {% endfor %}
                      </ul>
                    {% endif %}
                    <div class="row m-sm-3">
                      <div>
                        {% if not todo_item.completed %}
                        <small><a
                          href="{% url 'todo_list:complete_todo' todo_item.id %}"
                          >âœ… Complete Task</a
                        ></small>
                        {% else %}
                        <small><a
                          href="{% url 'todo_list:complete_todo' todo_item.id %}"
                        >Undo completion</a></small>
                        {% endif %}
                      </div>
                      <div class="ml-auto">
                        <small class="m-1"
                          ><a href="{% url 'todo_list:detail' todo_item.id %}"
                          >ðŸ–Š Edit</a
                          ></small
                        >
                        <small>
                          <a href="{% url 'todo_list:delete_todo_item' todo_item.id %}">
                            ðŸ—‘ Delete
                          </a>
                        </small>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
            </div>
          {% endfor %}
        </div>
      </ul>
      {% else %}
      <p>You have no to-do items due during this week!</p>
      {% endif %}
    </div>
  </div>
</div>


{% endblock %}